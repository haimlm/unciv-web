<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" href="data:,">
        <title>Unciv</title>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <style>
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                background: #000;
                height: 100vh;
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
            #canvas {
                border: none;
            }
        </style>
    </head>
    <body oncontextmenu="return false">
        <div>
            <canvas id="canvas"></canvas>
        </div>
        <script>
            (function () {
                var maxBootRetries = 8;
                var baseRetryDelayMs = 50;
                var bootWatchdogDelayMs = 4000;
                function hasBootProgress() {
                    return !!(
                        window.__uncivRunnerSelected
                        || window.__uncivWebValidationState
                        || window.__uncivUiProbeState
                        || window.__uncivMpProbeState
                        || window.__uncivWebValidationDone === true
                        || window.__uncivUiProbeResultJson
                        || window.__uncivMpProbeResultJson
                    );
                }
                function scheduleBootWatchdog(bootToken) {
                    setTimeout(function () {
                        if (window.__uncivBootToken !== bootToken) return;
                        if (window.__uncivBootInProgress) {
                            scheduleBootWatchdog(bootToken);
                            return;
                        }
                        if (!window.__uncivBootStarted || hasBootProgress()) return;
                        window.__uncivBootStarted = false;
                        window.__uncivBootFailures = (window.__uncivBootFailures || 0) + 1;
                        if (window.__uncivBootFailures <= maxBootRetries) {
                            var retryMs = baseRetryDelayMs * window.__uncivBootFailures;
                            console.warn('Unciv web boot stalled; retrying in ' + retryMs + 'ms');
                            setTimeout(boot, retryMs);
                        }
                    }, bootWatchdogDelayMs);
                }
                function boot() {
                    if (window.__uncivBootStarted || window.__uncivBootInProgress) return;
                    if (typeof window.main !== 'function') {
                        setTimeout(boot, 25);
                        return;
                    }
                    window.__uncivBootInProgress = true;
                    var bootToken = Date.now() + ':' + Math.random();
                    window.__uncivBootToken = bootToken;
                    try {
                        window.__uncivBootStarted = true;
                        window.main();
                        scheduleBootWatchdog(bootToken);
                    } catch (err) {
                        window.__uncivBootStarted = false;
                        window.__uncivBootInProgress = false;
                        window.__uncivBootFailures = (window.__uncivBootFailures || 0) + 1;
                        if (window.__uncivBootFailures <= maxBootRetries) {
                            var retryMs = baseRetryDelayMs * window.__uncivBootFailures;
                            console.warn('Unciv web boot failed; retrying in ' + retryMs + 'ms', err);
                            setTimeout(boot, retryMs);
                            return;
                        }
                        throw err;
                    }
                    window.__uncivBootInProgress = false;
                }
                if (document.readyState === 'complete') {
                    setTimeout(boot, 0);
                } else {
                    window.addEventListener('load', boot, { once: true });
                }
            })();
        </script>
        <script type="text/javascript" charset="utf-8" src="unciv.js"></script>
    </body>
</html>